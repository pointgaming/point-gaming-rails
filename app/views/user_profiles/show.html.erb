<%- model_class = Profile -%>

<div class="row">
  <div class="span3">
    <div class="row">

      <div class="span3">
        <%= render partial: 'user_profiles/user_image', locals: {model: @user} %>
      </div>

      <div class="span3">
        <div class="breadcrumb">
          <% if @user._id === current_user._id %>
            <%= link_to 'Edit Profile', edit_user_profile_path(@user), :class => 'btn btn-block' %>
          <% else %>
            <% if current_user.blocked_user?(@user) %>
              <%= link_to "User blocked!", "#", class: "btn", disabled: true %>
            <% elsif current_user.friends_with?(@user) %>
              <%= link_to "Already friends!", "#", class: "btn", disabled: true %>
            <% elsif current_user.friend_request_sent?(@user) %>
              <%= link_to "Friend request sent!", "#", class: "btn", disabled: true %>
            <% else %>
              <%= link_to 'Send Friend Request',
                    friend_requests_path(username: @user.username),
                    :method => :post,
                    :data => { :confirm => t('.confirm', :default => t("helpers.links.confirm", :default => 'Are you sure?')) },
                    :class => 'btn' %>
              <%= link_to 'Block User',
                    blocked_users_path(blocked_user: {username: @user.username}),
                    :method => :post,
                    :data => { :confirm => t('.confirm', :default => t("helpers.links.confirm", :default => 'Are you sure?')) },
                    :class => 'btn' %>
            <% end %>
          <% end %>
        </div>
      </div>

      <div class="span3">
        <h3><%= User.human_attribute_name(:game_id) %></h3>
        <div class="controls">
          <%= @user.game.try(:display_name) %>
        </div>
      </div>

      <div class="span3">
        <%= render partial: 'user_profiles/bio', locals: {model: @user.profile} %>
      </div>

    </div>
  </div>

  <div class="span9">
    <div class="row">
      <div class="span9">
        <div class="row">
          <div class="span5">
            <h1><%= @user.username %></h1>
            <p><%= @user.points %> Points</p>
            <p>Friends <%= link_to @user.friends.sum(:count), friends_path %></p>
            <p><%= @user.country %></p>
          </div>
          <div class="span4">
            <h1>Team</h1>
            <% unless @user.team.nil? %>
              <p><%= link_to @user.team.try(:name), team_path(@user.team) %></p>
            <% end %>
          </div>
        </div>
      </div>

      <div class="span2 pull-right">
        <h3>Sponsors</h3>
        <%= image_tag @user.avatar.url, :class => 'thumbnail' %>
        <%= image_tag @user.avatar.url, :class => 'thumbnail' %>
        <%= image_tag @user.avatar.url, :class => 'thumbnail' %>
        <%= image_tag @user.avatar.url, :class => 'thumbnail' %>
        <%= image_tag @user.avatar.url, :class => 'thumbnail' %>
        <%= image_tag @user.avatar.url, :class => 'thumbnail' %>
        <%= image_tag @user.avatar.url, :class => 'thumbnail' %>
      </div>

      <div class="span7">
        <%= render partial: 'user_profiles/match_history', locals: {models: @matches} %>
      </div>

      <div class="span7">
        <%= render partial: 'user_profiles/rig', locals: {model: @user.profile.try(:rig)} %>
      </div>

      <div class="span7">
        <%= render partial: 'user_profiles/demos', locals: {models: @user.demos.order_by(updated_at: :desc)} %>
      </div>

      <div class="span7">
        <%= render partial: 'user_profiles/configs', locals: {models: @user.configs} %>
      </div>
        
    </div>
    
  </div>
</div>
