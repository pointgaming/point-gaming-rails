<%- model_class = Profile -%>

<div class="row-fluid" id="user-profile">
  <div class="span3">
    <div class="row-fluid">

      <div class="span12">
        <%= render partial: 'user_profiles/user_image', locals: {model: @user} %>
      </div>

      <div class="span12">
        <div class="well">
          <% if @user._id === current_user._id %>
            <%= link_to 'Edit Profile', edit_user_profile_path(@user), :class => 'btn btn-block' %>
          <% else %>
            <% if current_user.blocked_user?(@user) %>
              <%= link_to "User blocked!", "#", class: "btn", disabled: true %>
            <% elsif current_user.friends_with?(@user) %>
              <%= link_to "Already friends!", "#", class: "btn", disabled: true %>
            <% elsif current_user.friend_request_sent?(@user) %>
              <%= link_to "Friend request sent!", "#", class: "btn", disabled: true %>
            <% else %>
              <%= link_to 'Send Friend Request',
                    friend_requests_path(username: @user.username),
                    :method => :post,
                    :data => { :confirm => t('.confirm', :default => t("helpers.links.confirm", :default => 'Are you sure?')) },
                    :class => 'btn' %>
              <%= link_to 'Block User',
                    blocked_users_path(blocked_user: {username: @user.username}),
                    :method => :post,
                    :data => { :confirm => t('.confirm', :default => t("helpers.links.confirm", :default => 'Are you sure?')) },
                    :class => 'btn' %>
            <% end %>
          <% end %>
        </div>
      </div>

      <div class="span12">
        <div class="row-fluid">
          <div class="span6 well">
            <div class="span12"><p><i class="icon-map-marker"></i><%= @user.country %></p></div>
          </div>

          <div class="span6 well">
            <div class="span12"><p><i class="icon-user"></i>Friends <%= link_to @user.friends.sum(:count), friends_path %></p></div>
          </div>
        </div>
      </div>

      <div class="span12" id="primary-game">
        <%= image_tag "counterstrikego.png" %>
        <h3><%= User.human_attribute_name(:game_id) %></h3>
        <h4><%= @user.game.try(:display_name) %></h4>
      </div>

      <div class="span12">
        <%= render partial: 'user_profiles/bio', locals: {model: @user.profile} %>
      </div>

    </div>
  </div>

  <div class="span9">
    <div class="row-fluid" id="profile-top-bar">
      <div class="span12">
        <div class="row-fluid">
          <div class="span8" id="username-container">
            <div class="row-fluid">

              <div class="span9">
                <h2><%= @user.username %></h2>
                <h4><%= @user.points %> Points</h4>
              </div>

            </div>
            
          </div>
          <div class="span4" id="team-container">
            <div class="row-fluid">
              <div class="span3" id="team-logo">
                <%= image_tag "team-logo.png" %>
              </div>
              <div class="span9">
                <h2>Team</h2>
                <% unless @user.team.nil? %>
                  <h4><%= link_to @user.team.try(:name), team_path(@user.team) %></h4>
                <% end %>
              </div> 
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="row-fluid">
      <div class="span12">
          <div class="row-fluid">

            <div class="span9">
              <%= render partial: 'user_profiles/match_history', locals: {models: @matches} %>
              <%= render partial: 'user_profiles/rig', locals: {model: @user.profile.try(:rig)} %>
              <% if @user.demos.exists? %>
                <%= render partial: 'user_profiles/demos', locals: {models: @user.demos.order_by(updated_at: :desc)} %>
              <% end %>
              <% if @user.configs.exists? %>
                <%= render partial: 'user_profiles/configs', locals: {models: @user.configs} %>
              <% end %>
            </div>

            <div class="span3">
              <h4>Sponsors</h4>
              <%= image_tag @user.avatar.url, :class => 'thumbnail' %>
              <%= image_tag @user.avatar.url, :class => 'thumbnail' %>
              <%= image_tag @user.avatar.url, :class => 'thumbnail' %>
              <%= image_tag @user.avatar.url, :class => 'thumbnail' %>
            </div>

          </div>
        </div>
      </div>
  </div>
</div>
