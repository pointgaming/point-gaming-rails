<h1>Lobby: <%= @game.name %></h1>

<div class="container-fluid">
  <div class="row-fluid">
    <div class="span9">
      <div id="lobby-games" class="container-fluid">
        <div class="row-fluid">
          <% if @rooms %>
            <ul class="thumbnails">
              <% @rooms.each do |room| %>
                <li class="span3">
                  <%= link_to image_tag('stream.png'), '#', :class => 'thumbnail' %>
                </li>
              <% end %>
            </ul>
          <% end %>
        </div>
      </div>

      <div class="tabbable">
        <ul class="nav nav-tabs">
          <li class="active">
            <a href="#chatbox-form" data-toggle="tag">Chat</a>
          </li>
          <li>
            <a href="#lobby-active-games" data-toggle="tag">Active Games</a>
          </li>
        </ul>

        <div class="tab-content">
          <div class="tab-pane active" id="chatbox-form">
            <form id="chatbox-form">
              <fieldset>
                <pre id="chatbox" class="pre-scrollable"></pre>

                <div class="form-inline">
                  <input type="text" placeholder="Say anything..." />
                  <button type="submit" class="btn">Send</button>
                </div>
              </fieldset>
            </form>
          </div>

          <div class="tab-pane" id="lobby-active-games">

          </div>
        </div>
      </div>
    </div>

    <div class="span3">
      <h4>Players: 3,252</h4>

      <div class="well">
        <ul>
          <li>Player 1</li>
          <li>Player 2</li>
          <li>Player 3</li>
          <li>Player 4</li>
          <li>Player 5</li>
        </ul>
      </div>
    </div>
  </div>
</div>

<%= javascript_tag do %>
  var createChatRoom = function() {
    var chat_room = new PointGaming.chatbox({
      message_window_selector: "#chatbox",
      chat_room: "<%="#{@game._id}"%>",
    }, PointGaming.socket);

    $("#chatbox-form").submit(function(e){
      var inputbox = $('input[type="text"]', this);
      var message = inputbox.val();
      if (message) chat_room.sendMessage(message);
      e.preventDefault();
      inputbox.val('');
    });
  };

  $(function () {
    if (PointGaming.authToken) {
      PointGaming.socket = io.connect(PointGaming.socketio_uri);
      PointGaming.socket.on("ready", function(){
        // send auth request
        PointGaming.socket.emit("auth", {auth_token: PointGaming.authToken});
      });

      // register listener for auth callback
      PointGaming.socket.on("auth_resp", function(data){
        if (data.success === true && data.username) {
          PointGaming.username = data.username;
          PointGaming.chatroom = createChatRoom();
        }
      });
    }
  });
<% end %>
