<%- model_class = Tournament -%>
<% content_for :footer_scripts do %>
  <%= javascript_include_tag "pages/user_tournaments" %>
<% end %>
<div class="row-fluid" id="tournaments">
  <%- hide_workflow ||= false %>
  <% unless hide_workflow %>
    <%= render :partial => 'workflow_navigation', locals: {edit: true} %>
  <% end %>

  <div class="row-fluid">
    <div class="span9">
      <div class="row-fluid">
        <div class="span12">
          <h2><%= @tournament.name %></h2>
          <% if @tournament.owner === current_user %>
              <%= link_to t('.destroy', :default => t("helpers.links.destroy")),
                      user_tournament_path(@tournament),
                      :method => 'delete',
                      :data => { :confirm => t('.confirm', :default => t("helpers.links.confirm", :default => 'Are you sure?')) },
                      :class => 'btn btn-mini btn-danger pull-right' %>
          <% end %>
        </div>
      </div>

      <div class="row-fluid">
        <div class="span6">

          <ul class="nav nav-tabs">
            <li class="active"><a href="#overview" data-toggle="tab">Overview</a></li>
            <li><a href="#maps" data-toggle="tab">Maps</a></li>
            <li><a href="#rules" data-toggle="tab">Rules</a></li>
          </ul>

          <div class="tab-content">
            <div class="tab-pane active" id="overview">
              <div class="control-group">
                <%= label @tournament, :start_datetime, :class => 'control-label' %>
                <div class="controls">
                  <%=ldate @tournament.start_datetime %>
                </div>
              </div>
              <div class="control-group">
                <%= label @tournament, :format, :class => 'control-label' %>
                <div class="controls">
                  <%=t @tournament.format %>
                </div>
              </div>
              <div class="control-group">
                <%= label @tournament, :type, :class => 'control-label' %>
                <div class="controls">
                  <%=t @tournament.type %>
                </div>
              </div>
              <div class="control-group">
                <%= label @tournament, :game_id, :class => 'control-label' %>
                <div class="controls">
                  <%= @tournament.game.try(:display_name) %>
                </div>
              </div>
              <div class="control-group">
                <%= label @tournament, :game_type_id, :class => 'control-label' %>
                <div class="controls">
                  <%= @tournament.game_type.try(:name) %>
                </div>
              </div>

              <div id="prize-pool-widget" class="widget">
                <div class="widget-header">
                  <h3>Prize Pool</h3>
                </div>
                <div class="widget-content scrollable">
                  <% @tournament.prizepool.each do |placement, amount| %>
                    <div class="control-group">
                      <%= label placement, ActiveSupport::Inflector.ordinalize(placement) %>
                      <div class="controls">
                        <%= number_to_currency amount %>
                      </div>
                    </div>
                  <% end %>
                </div>
              </div>

              <div class="control-group">
                <%= label @tournament, :prizepool_total, :class => 'control-label' %>
                <div class="controls">
                  <%=number_to_currency @tournament.prizepool_total %>
                </div>
              </div>
              <div class="control-group">
                <%= label @tournament, :owner, :class => 'control-label' %>
                <div class="controls">
                  <%= @tournament.owner.try(:username) %>
                </div>
              </div>

              <div id="collaborators-widget" class="widget">
                <div class="widget-header">
                  <h3>Collaborators</h3>
                </div>
                <div class="widget-content scrollable">
                  <% @tournament.collaborators.non_ownership.each do |collaborator| %>
                    <div class="control-group">
                      <div class="controls">
                        <%= collaborator.user.try(:username) %>
                      </div>
                    </div>
                  <% end %>
                </div>
              </div>

            </div>
            <div class="tab-pane" id="maps">
              <div class="control-group">
                <%= @tournament.maps %>
              </div>
            </div>
            <div class="tab-pane" id="rules">
              <div class="control-group">
                <%= @tournament.details %>
              </div>
            </div>
          </div>

          <% if @tournament.stream_slug.present? %>
            <%= link_to 'Stream', stream_path(@tournament.stream_slug), :class => 'btn btn-block' %>
          <% end %>
        </div>

        <div class="span6">

          <div id="registration-widget" class="widget">
            <div class="widget-header">
              <h3>Registration</h3>
            </div>
            <div class="widget-content scrollable">
              <div class="control-group">
                <%= label @tournament, :signup_start_datetime, :class => 'control-label' %>
                <div class="controls">
                  <%=ldate @tournament.signup_start_datetime %>
                </div>
              </div>
              <div class="control-group">
                <%= label @tournament, :signup_end_datetime, :class => 'control-label' %>
                <div class="controls">
                  <%=ldate @tournament.signup_end_datetime %>
                </div>
              </div>
              <div class="control-group">
                <% if @tournament.has_user_signed_up?(current_user) %>
                  <%= link_to 'Leave', tournament_player_path(@tournament, current_user),
                              :data => { :confirm => t('.confirm', :default => t("helpers.links.confirm", :default => 'Are you sure?')) },
                              :method => :delete, :class => 'btn btn-block' %>
                <% else %>
                  <%= link_to 'Join', tournament_players_path(@tournament),
                              :data => { :confirm => t('.confirm', :default => t("helpers.links.confirm", :default => 'Are you sure?')) },
                              :method => :post, :class => 'btn btn-block' %>
                <% end %>
              </div>
            </div>
          </div>

          <div id="registered-players-widget" class="widget">
            <div class="widget-header">
              <h3>Registered Players (<%= "#{@tournament.player_count}/#{@tournament.player_limit}" %>)</h3>
            </div>
            <div class="widget-content scrollable">
              <% @tournament.players.each do |player| %>
                <div class="control-group">
                  <div class="controls">
                    <%= player.user.try(:username) %>
                  </div>
                </div>
              <% end %>
            </div>
          </div>

          <%= link_to 'Brackets', '#', :class => 'btn btn-block' %>

        </div>
      </div>
    </div>
    <div class="span3">
      <%= render :partial => 'user_tournaments/sponsors' %>
    </div>
  </div>

</div>
