<div class="row-fluid" id="tournaments">
  <div class="row-fluid">
    <div class="span12">
      <div class="span3">
        <div class="widget <%= @tournament.game.decorate.html_class %>" id="primary-game">
          <h3>Game</h3>
          <h4><%= @tournament.game.try(:display_name) %></h4>
        </div>
        <div class="well well-small">
          Check-In:
          <span id="time-left" style="display: none">
            <%= @tournament.checkin_date %>
          </span>

          <br />

          Starts: <%= ldate @tournament.signup_ends_at %>
        </div>
        <%= render "registrations/widget" %>
        <div class="well well-small">
          <div class="row-fluid">
            <div class="span6">
              <%= link_to "Stream", @tournament.stream_slug.present?? stream_path(@tournament.stream_slug) : nil, class: "btn btn-block", disabled: !@tournament.stream_slug.present? %>
            </div>
            <div class="span6">
              <%= link_to "Brackets", brackets_tournament_path(@tournament), class: "btn btn-block", disabled: !@tournament.started? %>
            </div>
          </div>
        </div>
        <div id="prize-pool-widget" class="widget">
          <div class="widget-header">
            <h3>Prize Pool</h3>
          </div>
          <div class="widget-content scrollable">
            <table class="table table-bordered table-striped">
              <tbody>
                <% @tournament.prizepool.each do |placement, amount| %>
                  <tr>
                    <td><%= label placement, ActiveSupport::Inflector.ordinalize(placement) %></td>
                    <td><%= number_to_currency amount %></td>
                  </tr>
                <% end %>
              </tbody>
            </table>
          </div>
        </div>
        <div id="collaborators-widget" class="widget">
          <div class="widget-header">
            <h3>Admins</h3>
          </div>
          <div class="widget-content scrollable">
            <div class="control-group">
              <div class="controls">
                <%= link_to @tournament.owner.username, @tournament.owner %>
              </div>
            </div>

            <% @tournament.collaborators.each do |collaborator| %>
              <div class="control-group">
                <div class="controls">
                  <%- c = User.find(collaborator) -%>
                  <%= link_to c.username, c %>
                </div>
              </div>
            <% end %>
          </div>
        </div>
        <div class="widget">
          <div class="widget-header">
            <h3>Players (<%= "#{@tournament.players.count}/#{@tournament.player_limit}" %>)</h3>
          </div>
          <div class="widget-content">
            <% @tournament.players.each do |player| %>
              <div class="control-group">
                <div class="controls">
                  <%= link_to player.username, user_path(player.username) %>
                </div>
              </div>
            <% end %>
          </div>
        </div>
      </div>
      <div class="span9">
        <div id="tournament-name-wrapper" class="row-fluid widget">
          <div class="span1 tournament-thumb"><img src="//placehold.it/80x80"></div>
          <div class="span8 widget-content">
            <h3>
              <%= @tournament.name %>
            </h3>
            <h4>Organizer: <%= link_to @tournament.owner.username, @tournament.owner %></h4>
          </div>
          <div class="span3 widget-content game-type">
            <div class="span12">
              <h4><%= @tournament.game_type.try(:name) %></h4>
            </div>
            <div class="span12">
              <h4><%=t @tournament.format %></h4>
            </div>
          </div>
        </div>
        <% if @tournament.started? && @tournament.checked_in?(current_user) %>
          <div class="span9 middle-content">
            <div class="widget">
              <div class="widget-header">
                <h3>
                  Current Match
                </h3>
              </div>
              <div class="widget-content center">
                <h3>
                  Opponent:
                </h3>
                <h4>
                  <%= current_player.current_opponent || "TBD" %>
                </h4>
                <% if current_player.current_opponent != "TBD" %>
                  <p>
                    <%= link_to "Report Scores", "#report-scores", class: "btn btn-success", role: "button", data: { toggle: "modal" } %>
                  </p>
                <% end %>
              </div>
            </div>
          </div>
          <% if current_player.current_opponent != "TBD" %>
            <div id="report-scores" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="report-scores-label" aria-hidden="true">
              <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">Ã—</button>
                <h3 id="report-scores-label">Report Scores</h3>
              </div>
              <%= form_tag report_scores_tournament_path do %>
                <div class="modal-body">
                  <p>
                    Games <strong><%= current_user %></strong> has won:
                  </p>

                  <%= number_field_tag :mine, nil, in: 0..9 %>

                  <p>
                    Games <strong><%= current_player.current_opponent %></strong> has won:
                  </p>

                  <%= number_field_tag :his %>
                </div>
                <div class="modal-footer">
                  <button class="btn" data-dismiss="modal" aria-hidden="true">Cancel</button>
                  <%= submit_tag "Submit", class: "btn btn-primary" %>
                </div>
              <% end %>
            </div>
          <% end %>
        <% end %>
        <div class="span2">
          <%= render "sponsors" %>
        </div>
        <div class="span9 middle-content">
          <div class="widget">
            <div class="widget-header">
              <h3>Rules</h3>
            </div>
            <div class="widget-content">
              <%= @tournament.details %>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
